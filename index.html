<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>DRC Green Corridor</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <style>
      :root {
        --bg: #0b0f0a;
        --text: #f2f3f1;
        --muted: rgba(242, 243, 241, 0.72);
        --panel: rgba(8, 10, 7, 0.78);
        --green: #7fc97f;
        --red: #e34a33;
        --accent: #c7d1bf;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: "IBM Plex Sans", "Helvetica Neue", Arial, sans-serif;
      }
      .hero {
        position: relative;
        height: 100vh;
        overflow: hidden;
        display: grid;
        place-items: center;
      }
      .hero video {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: contrast(1.05) brightness(1.25);
      }
      .hero::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          180deg,
          rgba(4, 6, 4, 0.08) 0%,
          rgba(4, 6, 4, 0.35) 55%,
          rgba(4, 6, 4, 0.55) 100%
        );
      }
      .hero-content {
        position: relative;
        z-index: 1;
        text-align: center;
        padding: 0 8vw;
        max-width: 980px;
      }
      .hero h1 {
        font-size: clamp(2.4rem, 5vw, 4.2rem);
        margin: 0 0 14px 0;
        letter-spacing: 0.5px;
      }
      .hero p {
        margin: 0;
        font-size: clamp(1.2rem, 2.4vw, 1.8rem);
        color: var(--accent);
      }
      .scroll-shell {
        position: relative;
      }
      #map {
        height: 100vh;
        width: 100%;
        position: sticky;
        top: 0;
        z-index: 1;
      }
      .story {
        position: relative;
        z-index: 2;
        margin-top: -100vh;
        pointer-events: none;
      }
      .step {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding: 8vh 7vw;
      }
      .step .panel {
        max-width: 460px;
        background: var(--panel);
        backdrop-filter: blur(6px);
        padding: 18px 20px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 14px;
        pointer-events: auto;
      }
      .panel h2 {
        margin: 0 0 10px 0;
        font-weight: 600;
      }
      .panel p {
        margin: 0;
        color: var(--muted);
        line-height: 1.55;
      }
      .legend {
        display: grid;
        gap: 8px;
        margin-top: 12px;
        font-size: 0.95rem;
      }
      .legend span {
        display: inline-flex;
        align-items: center;
        gap: 10px;
      }
      .swatch {
        width: 18px;
        height: 18px;
        border-radius: 4px;
        border: 1px solid rgba(255, 255, 255, 0.5);
      }
      .swatch.green {
        background: rgba(127, 201, 127, 0.45);
      }
      .swatch.red {
        background: rgba(227, 74, 51, 0.7);
      }
      .footer {
        padding: 10vh 7vw 12vh;
        background: #080a07;
        color: var(--muted);
      }
      @media (max-width: 900px) {
        .step {
          justify-content: center;
        }
        .step .panel {
          max-width: 90vw;
        }
      }
    </style>
  </head>
  <body>
    <section class="hero">
      <video
        src="assets/1deforsmaller.mov"
        autoplay
        muted
        loop
        playsinline
      ></video>
      <div class="hero-content">
        <h1>Democratic Republic of Congo's Green Corridor</h1>
        <p>Powerful conservation solution or greenwashing for logging?</p>
      </div>
    </section>

    <section class="scroll-shell">
      <div id="map"></div>

      <div class="story">
        <section class="step" data-step="0">
          <div class="panel">
            <h2>From a Global View</h2>
            <p>
              DRC has X% of the world's tropical forests, but every year X% is
              cut down for logging.
            </p>
          </div>
        </section>

        <section class="step" data-step="1">
          <div class="panel">
            <h2>Zooming into the DRC</h2>
            <p>
              The country sits at the heart of the Congo Basin, one of the most
              critical forest regions on Earth.
            </p>
          </div>
        </section>

        <section class="step" data-step="2">
          <div class="panel">
            <h2>Green Corridor Footprint</h2>
            <p>
              The green corridor is proposed as a sweeping conservation
              initiative across central DRC.
            </p>
            <div class="legend">
              <span><span class="swatch green"></span>Green Corridor</span>
            </div>
          </div>
        </section>

        <section class="step" data-step="3">
          <div class="panel">
            <h2>Concession Overlap</h2>
            <p>
              Selected concession areas appear on top of the corridor in red.
            </p>
            <div class="legend">
              <span><span class="swatch green"></span>Green Corridor</span>
              <span><span class="swatch red"></span>Concession Selection</span>
            </div>
          </div>
        </section>
      </div>
    </section>

    <section class="footer">
      <p>
        Continue the article here with additional context, interviews, or data
        notes.
      </p>
    </section>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script>
      const map = L.map("map", {
        zoomControl: true,
        scrollWheelZoom: false,
        attributionControl: true,
      }).setView([5, 20], 3);

      L.tileLayer(
        "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
        {
          maxZoom: 18,
          attribution: "Tiles © Esri",
        }
      ).addTo(map);

      L.tileLayer(
        "https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",
        {
          maxZoom: 18,
          attribution: "Borders © Esri",
        }
      ).addTo(map);

      const greenStyle = {
        color: "#7fc97f",
        weight: 1.2,
        opacity: 0.8,
        fillColor: "#7fc97f",
        fillOpacity: 0.45,
      };

      const redStyle = {
        color: "#e34a33",
        weight: 1.4,
        opacity: 0.9,
        fillColor: "#e34a33",
        fillOpacity: 0.85,
      };

      let greenLayer;
      let redLayer;
      let corridorBounds;

      Promise.all([
        fetch("data/green_corridor.geojson").then((r) => r.json()),
        fetch("data/concessions.geojson").then((r) => r.json()),
      ])
        .then(([greenData, redData]) => {
          greenLayer = L.geoJSON(greenData, { style: greenStyle }).addTo(map);
          redLayer = L.geoJSON(redData, { style: redStyle }).addTo(map);

          // Force the corridor visible for debugging.
          greenLayer.setStyle({ fillOpacity: 0.45, opacity: 0.8 });
          redLayer.setStyle({ fillOpacity: 0, opacity: 0 });

          corridorBounds = greenLayer.getBounds();
          if (corridorBounds && corridorBounds.isValid()) {
            map.fitBounds(corridorBounds.pad(0.3));
          }
          setStep(0);
        })
        .catch((err) => {
          console.error("Failed to load GeoJSON", err);
        });

      function setStep(step) {
        if (!greenLayer || !redLayer) return;

        if (step === 0) {
          map.flyTo([5, 20], 3, { duration: 3.6 });
          greenLayer.setStyle({ fillOpacity: 0, opacity: 0 });
          redLayer.setStyle({ fillOpacity: 0, opacity: 0 });
          return;
        }

        if (step === 1) {
          if (corridorBounds && corridorBounds.isValid()) {
            map.fitBounds(corridorBounds.pad(0.3), { animate: true, duration: 5.0 });
          } else {
            map.flyTo([-2.8, 23.7], 5, { duration: 5.0 });
          }
          greenLayer.setStyle({ fillOpacity: 0, opacity: 0 });
          redLayer.setStyle({ fillOpacity: 0, opacity: 0 });
          return;
        }

        if (step === 2) {
          greenLayer.bringToFront();
          greenLayer.setStyle({ fillOpacity: 0.45, opacity: 0.8 });
          redLayer.setStyle({ fillOpacity: 0, opacity: 0 });
          return;
        }

        if (step >= 3) {
          if (corridorBounds && corridorBounds.isValid()) {
            map.fitBounds(corridorBounds.pad(0.15), { animate: true, duration: 2.6 });
          }
          greenLayer.bringToFront();
          redLayer.bringToFront();
          greenLayer.setStyle({ fillOpacity: 0.45, opacity: 0.8 });
          redLayer.setStyle({ fillOpacity: 0.85, opacity: 0.95 });
        }
      }

      const steps = document.querySelectorAll(".step");
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const step = Number(entry.target.dataset.step || 0);
              setStep(step);
            }
          });
        },
        {
          threshold: 0.4,
          rootMargin: "0px 0px -20% 0px",
        }
      );

      steps.forEach((step) => observer.observe(step));
    </script>
  </body>
</html>
